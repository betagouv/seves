{% extends "tiac/base.html" %}
{% load dsfr_tags widget_tweaks static render_field_with_inline_label %}
{% block extrahead %}
    <link rel="stylesheet" href="{% static 'core/_etablissement_card.css' %}">
    <link rel="stylesheet" href="{% static 'tiac/investigation.css' %}">
{% endblock extrahead %}
{% block content %}
    <form class="fr-container--fluid fr-background-alt--grey" method="post">
        {% csrf_token %}
        <main class="main-container">
            <div class="evenement-produit-form-header fr-grid-row">
                <h1 class="fr-col-6">Création d'une investigation de TIAC</h1>
                <div class="fr-col-6 fr-mb-auto fr-grid-row fr-grid-row--right">
                    {% if form.instance and form.instance.is_draft %}
                        <button type="submit" name="action" value="draft" class="fr-btn fr-btn--secondary fr-mr-2w">
                            Enregistrer le brouillon
                        </button>
                    {% endif %}
                    <button id="submit_publish" type="submit" name="action" value="publish" class="fr-btn">
                        {% if form.instance.pk %}Enregistrer{% else %}Publier{% endif %}
                    </button>
                </div>
            </div>

            {% if form.non_field_errors %}
                <section class="fr-my-4v fr-input-group fr-input-group--error">
                    {{ form.non_field_errors }}
                </section>
            {% endif %}

            <fieldset class="fr-fieldset form-fieldset">
                <legend class="fr-fieldset__legend fr-h3">Le contexte</legend>

                <div class="fr-grid-row fr-grid-row--gutters fr-col">
                    <div class="fr-col-12 fr-col-lg-4">
                        <div class="fr-input-group">
                            <label class="fr-label" for="date-creation-input">Date de création</label>
                            <input type="text" id="date-creation-input" class="fr-input" value="{% if form.instance.date_creation %}{{ form.instance.date_creation|date:"d/m/Y" }}{% else %}{% now 'd/m/Y' %}{% endif %}" disabled>
                        </div>
                        {% dsfr_form_field form.date_reception %}
                        {% dsfr_form_field form.evenement_origin %}
                        {% dsfr_inline_radio_field form.modalites_declaration %}
                    </div>

                    <div class="fr-col-12 fr-col-lg-4">
                        {% dsfr_form_field form.contenu %}
                    </div>

                    <div class="fr-col-12 fr-col-lg-4">
                        {% dsfr_inline_radio_field form.notify_ars %}
                        {% dsfr_inline_radio_field form.will_trigger_inquiry %}
                        {% dsfr_form_field form.numero_sivss %}
                        {% dsfr_form_field form.type_evenement %}
                    </div>
                </div>
            </fieldset>


            <fieldset class="fr-fieldset form-fieldset fr-mt-4v cas-fieldset">
                <legend class="fr-fieldset__legend fr-h3">Cas</legend>
                <div class="fr-grid-row fr-grid-row--gutters fr-col">
                    <div class="fr-col-12 fr-col-lg-2">
                        {% dsfr_form_field form.nb_sick_persons %}
                    </div>
                    <div class="fr-col-12 fr-col-lg-2">
                        {% dsfr_form_field form.nb_sick_persons_to_hospital %}
                    </div>
                    <div class="fr-col-12 fr-col-lg-2">
                        {% dsfr_form_field form.nb_dead_persons %}
                    </div>
                    <div class="fr-col-12 fr-col-lg-3">
                        {% dsfr_form_field form.datetime_first_symptoms %}
                    </div>
                    <div class="fr-col-12 fr-col-lg-3">
                        {% dsfr_form_field form.datetime_last_symptoms %}
                    </div>
                </div>

            </fieldset>

        </main>
    </form>
{% endblock %}
